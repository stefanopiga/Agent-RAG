
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Docling RAG Agent">
      
      
        <meta name="author" content="Stefano">
      
      
      
        <link rel="prev" href="../coding-standards/">
      
      
        <link rel="next" href="../troubleshooting-guide/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Testing Strategy - Docling RAG Agent</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#testing-strategy-docling-rag-agent" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Docling RAG Agent" class="md-header__button md-logo" aria-label="Docling RAG Agent" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Docling RAG Agent
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Testing Strategy
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stefanopiga/docling-rag-agent" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    docling-rag-agent
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../getting-started/" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../architecture/" class="md-tabs__link">
        
  
  
    
  
  Architecture

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../development-guide/" class="md-tabs__link">
        
  
  
    
  
  Development Guide

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../coding-standards/" class="md-tabs__link">
        
  
  
    
  
  Coding Standards

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  Testing Strategy

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../unified-project-structure.md" class="md-tabs__link">
        
  
  
    
  
  Project Structure

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../troubleshooting-guide/" class="md-tabs__link">
        
  
  
    
  
  Troubleshooting Guide

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../langfuse-dashboard-guide/" class="md-tabs__link">
        
  
  
    
  
  LangFuse Dashboard

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../api-reference/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Docling RAG Agent" class="md-nav__button md-logo" aria-label="Docling RAG Agent" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Docling RAG Agent
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stefanopiga/docling-rag-agent" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    docling-rag-agent
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../development-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development Guide
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../coding-standards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coding Standards
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Testing Strategy
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Strategy
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-test-driven-development-tdd" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Test-Driven Development (TDD)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Test-Driven Development (TDD)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-tdd-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 TDD Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-tdd-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 TDD Benefits
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-test-organization" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Test Organization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Test Organization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-directory-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Directory Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-test-file-naming" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Test File Naming
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-test-categories" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 Test Categories
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-unit-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Unit Testing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Unit Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-unit-test-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Unit Test Structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-mocking-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Mocking Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-async-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 Async Testing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-coverage-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4 Coverage Requirements
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-integration-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Integration Testing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Integration Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-integration-test-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 Integration Test Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-test-fixtures" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Test Fixtures
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-end-to-end-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. End-to-End Testing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. End-to-End Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-playwright-e2e-tests" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.1 Playwright E2E Tests
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-e2e-test-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        5.2 E2E Test Data
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-ragas-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. RAGAS Evaluation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. RAGAS Evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-ragas-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.1 RAGAS Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-ragas-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.2 RAGAS Implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-langfuse-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        6.3 LangFuse Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-test-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Test Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Test Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-pytest-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.1 pytest Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-coverage-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.2 Coverage Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-test-markers" class="md-nav__link">
    <span class="md-ellipsis">
      
        7.3 Test Markers
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-cicd-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. CI/CD Integration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. CI/CD Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81-github-actions-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.1 GitHub Actions Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82-pre-commit-hooks" class="md-nav__link">
    <span class="md-ellipsis">
      
        8.2 Pre-commit Hooks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-test-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Test Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Test Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91-test-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.1 Test Isolation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92-test-data-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.2 Test Data Management
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#93-error-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.3 Error Testing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#94-performance-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        9.4 Performance Testing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-test-maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. Test Maintenance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Test Maintenance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-test-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.1 Test Documentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-test-refactoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        10.2 Test Refactoring
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-testing-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. Testing Checklist
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-references" class="md-nav__link">
    <span class="md-ellipsis">
      
        12. References
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12. References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#internal-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Internal Documentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-references" class="md-nav__link">
    <span class="md-ellipsis">
      
        External References
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changelog" class="md-nav__link">
    <span class="md-ellipsis">
      
        Changelog
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../unified-project-structure.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project Structure
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting Guide
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../langfuse-dashboard-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LangFuse Dashboard
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/ingestion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ingestion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="testing-strategy-docling-rag-agent">Testing Strategy - docling-rag-agent</h1>
<p><strong>Version:</strong> 1.0<br />
<strong>Last Updated:</strong> 2025-01-27<br />
<strong>Python Version:</strong> &gt;=3.10</p>
<h2 id="overview">Overview</h2>
<p>Questo documento definisce la strategia di testing per il progetto <code>docling-rag-agent</code>. La strategia segue principi <strong>Test-Driven Development (TDD)</strong> con organizzazione rigorosa dei test, coverage minimo del 70%, e integrazione completa con CI/CD.</p>
<p><strong>Principi Fondamentali:</strong>
- <strong>TDD First</strong>: Scrivere test prima del codice (Red-Green-Refactor)
- <strong>Coverage Enforcement</strong>: Coverage minimo 70% per moduli core, 80% per moduli critici
- <strong>Test Organization</strong>: Organizzazione rigorosa in unit/integration/e2e
- <strong>Quality Metrics</strong>: RAGAS evaluation per validare qualità RAG
- <strong>Observability</strong>: Test integrati con LangFuse per tracking metriche</p>
<hr />
<h2 id="1-test-driven-development-tdd">1. Test-Driven Development (TDD)</h2>
<h3 id="11-tdd-workflow">1.1 TDD Workflow</h3>
<p><strong>Pattern Red-Green-Refactor:</strong></p>
<ol>
<li><strong>Red</strong>: Scrivere test che fallisce (definisce comportamento desiderato)</li>
<li><strong>Green</strong>: Scrivere codice minimo per far passare il test</li>
<li><strong>Refactor</strong>: Migliorare codice mantenendo test verde</li>
</ol>
<p><strong>Esempio:</strong></p>
<pre><code class="language-python"># Step 1: Red - Test che fallisce
def test_search_knowledge_base_returns_formatted_results():
    &quot;&quot;&quot;Test that search returns formatted results.&quot;&quot;&quot;
    result = search_knowledge_base(&quot;test query&quot;, limit=5)
    assert &quot;test query&quot; in result
    assert len(result.split(&quot;\n&quot;)) &gt; 0

# Step 2: Green - Implementazione minima
def search_knowledge_base(query: str, limit: int = 5) -&gt; str:
    &quot;&quot;&quot;Search knowledge base.&quot;&quot;&quot;
    return f&quot;Results for: {query}&quot;

# Step 3: Refactor - Migliorare implementazione
def search_knowledge_base(query: str, limit: int = 5) -&gt; str:
    &quot;&quot;&quot;Search knowledge base with proper formatting.&quot;&quot;&quot;
    results = await search_knowledge_base_structured(query, limit)
    return format_results(results)
</code></pre>
<h3 id="12-tdd-benefits">1.2 TDD Benefits</h3>
<p><strong>Per questo progetto:</strong>
- <strong>Regression Prevention</strong>: Test catturano regressioni prima del deploy
- <strong>Design Guidance</strong>: Test guidano design API pulite e testabili
- <strong>Documentation</strong>: Test servono come documentazione eseguibile
- <strong>Confidence</strong>: Refactoring sicuro con suite test completa</p>
<hr />
<h2 id="2-test-organization">2. Test Organization</h2>
<h3 id="21-directory-structure">2.1 Directory Structure</h3>
<p><strong>Struttura rigorosa:</strong></p>
<pre><code>tests/
├── conftest.py              # Shared fixtures and configuration
├── README.md                # Test documentation
├── unit/                    # Unit tests (&gt;70% coverage)
│   ├── test_rag_service.py
│   ├── test_embedder.py
│   ├── test_langfuse_integration.py
│   ├── test_performance_metrics.py
│   └── test_mcp_server_validation.py
├── integration/             # Integration tests
│   ├── test_mcp_server_integration.py
│   └── test_observability_endpoints.py
├── e2e/                    # End-to-end tests (Playwright)
│   └── test_streamlit_workflow.py
└── fixtures/               # Test fixtures + golden dataset
    └── golden_dataset.json  # 20+ query-answer pairs (RAGAS)
</code></pre>
<h3 id="22-test-file-naming">2.2 Test File Naming</h3>
<p><strong>Convenzioni:</strong>
- File: <code>test_*.py</code> o <code>*_test.py</code>
- Classe test: <code>Test&lt;ComponentName&gt;</code> (es. <code>TestPrometheusMetrics</code>)
- Funzione test: <code>test_&lt;functionality&gt;_&lt;condition&gt;_&lt;expected_result&gt;</code></p>
<p><strong>Esempio:</strong></p>
<pre><code class="language-python"># tests/unit/test_rag_service.py
class TestRAGService:
    &quot;&quot;&quot;Test RAG service functionality.&quot;&quot;&quot;

    def test_search_knowledge_base_with_valid_query_returns_results(self):
        &quot;&quot;&quot;Test search returns results for valid query.&quot;&quot;&quot;
        pass

    def test_search_knowledge_base_with_empty_query_raises_error(self):
        &quot;&quot;&quot;Test search raises error for empty query.&quot;&quot;&quot;
        pass
</code></pre>
<h3 id="23-test-categories">2.3 Test Categories</h3>
<p><strong>Unit Tests:</strong>
- Testano singole funzioni/moduli in isolamento
- Mock di dipendenze esterne (DB, API, LangFuse)
- Coverage target: &gt;70% per moduli core</p>
<p><strong>Integration Tests:</strong>
- Testano interazione tra componenti
- Usano test database o mock services
- Coverage target: &gt;25% delle interazioni critiche</p>
<p><strong>E2E Tests:</strong>
- Testano workflow completi end-to-end
- Usano servizi reali (test environment)
- Coverage target: &gt;15% dei workflow critici</p>
<hr />
<h2 id="3-unit-testing">3. Unit Testing</h2>
<h3 id="31-unit-test-structure">3.1 Unit Test Structure</h3>
<p><strong>Pattern AAA (Arrange-Act-Assert):</strong></p>
<pre><code class="language-python">import pytest
from unittest.mock import AsyncMock, patch, MagicMock

@pytest.mark.asyncio
async def test_search_knowledge_base_returns_formatted_results():
    # Arrange: Setup test data and mocks
    query = &quot;test query&quot;
    limit = 5
    mock_results = [
        {&quot;content&quot;: &quot;result 1&quot;, &quot;source&quot;: &quot;doc1&quot;},
        {&quot;content&quot;: &quot;result 2&quot;, &quot;source&quot;: &quot;doc2&quot;}
    ]

    with patch('core.rag_service.search_knowledge_base_structured') as mock_search:
        mock_search.return_value = mock_results

        # Act: Execute function under test
        result = await query_knowledge_base(query, limit)

        # Assert: Verify results
        assert &quot;result 1&quot; in result
        assert &quot;doc1&quot; in result
        mock_search.assert_called_once_with(query, limit)
</code></pre>
<h3 id="32-mocking-patterns">3.2 Mocking Patterns</h3>
<p><strong>LangFuse Mocking:</strong></p>
<pre><code class="language-python">from unittest.mock import patch, MagicMock

def test_langfuse_span_creates_span_when_available():
    &quot;&quot;&quot;Test LangFuse span creation when client available.&quot;&quot;&quot;
    with patch('docling_mcp.server.get_langfuse_client') as mock_get_client:
        mock_client = MagicMock()
        mock_span = MagicMock()
        mock_client.span.return_value = mock_span
        mock_get_client.return_value = mock_client

        # Test span creation
        async with langfuse_span(&quot;test-span&quot;) as span_ctx:
            assert span_ctx[&quot;span&quot;] == mock_span
</code></pre>
<p><strong>Database Mocking:</strong></p>
<pre><code class="language-python">from unittest.mock import AsyncMock, patch

@pytest.mark.asyncio
async def test_search_db_with_mock_connection():
    &quot;&quot;&quot;Test database search with mocked connection.&quot;&quot;&quot;
    mock_conn = AsyncMock()
    mock_conn.fetch.return_value = [
        {&quot;id&quot;: 1, &quot;content&quot;: &quot;test&quot;, &quot;similarity&quot;: 0.95}
    ]

    with patch('utils.db_utils.db_pool.acquire') as mock_acquire:
        mock_acquire.return_value.__aenter__.return_value = mock_conn

        results = await search_vector_db(embedding, limit=5)
        assert len(results) == 1
        assert results[0][&quot;content&quot;] == &quot;test&quot;
</code></pre>
<p><strong>OpenAI/LLM Mocking:</strong></p>
<pre><code class="language-python">from unittest.mock import AsyncMock, patch

@pytest.mark.asyncio
async def test_embedding_generation_with_mock_openai():
    &quot;&quot;&quot;Test embedding generation with mocked OpenAI client.&quot;&quot;&quot;
    mock_response = MagicMock()
    mock_response.data = [MagicMock(embedding=[0.1, 0.2, 0.3])]

    with patch('ingestion.embedder.LangfuseAsyncOpenAI') as mock_client_class:
        mock_client = AsyncMock()
        mock_client.embeddings.create = AsyncMock(return_value=mock_response)
        mock_client_class.return_value = mock_client

        embedder = EmbeddingGenerator()
        embedding = await embedder.embed_query(&quot;test query&quot;)
        assert len(embedding) == 3
</code></pre>
<h3 id="33-async-testing">3.3 Async Testing</h3>
<p><strong>pytest-asyncio:</strong>
- Usare <code>@pytest.mark.asyncio</code> per test async
- Configurare <code>asyncio_mode = "auto"</code> in <code>pyproject.toml</code></p>
<p><strong>Esempio:</strong></p>
<pre><code class="language-python">import pytest

@pytest.mark.asyncio
async def test_async_function():
    &quot;&quot;&quot;Test async function.&quot;&quot;&quot;
    result = await async_function()
    assert result is not None

# Event loop fixture in conftest.py
@pytest.fixture(scope=&quot;session&quot;)
def event_loop():
    &quot;&quot;&quot;Create event loop for test session.&quot;&quot;&quot;
    loop = asyncio.get_event_loop_policy().new_event_loop()
    yield loop
    loop.close()
</code></pre>
<h3 id="34-coverage-requirements">3.4 Coverage Requirements</h3>
<p><strong>Per Modulo:</strong>
- <strong>Core modules</strong> (<code>core/</code>, <code>ingestion/</code>): &gt;70% coverage
- <strong>Critical modules</strong> (<code>docling_mcp/</code>): &gt;80% coverage
- <strong>Utility modules</strong> (<code>utils/</code>): &gt;60% coverage</p>
<p><strong>Verifica Coverage:</strong></p>
<pre><code class="language-bash"># Run tests with coverage
pytest --cov=core --cov=docling_mcp --cov-report=term-missing

# Generate HTML report
pytest --cov=core --cov=docling_mcp --cov-report=html

# Check specific threshold
pytest --cov=core --cov-fail-under=70
</code></pre>
<hr />
<h2 id="4-integration-testing">4. Integration Testing</h2>
<h3 id="41-integration-test-patterns">4.1 Integration Test Patterns</h3>
<p><strong>Test Database Integration:</strong></p>
<pre><code class="language-python">import pytest
from utils.db_utils import DatabasePool

@pytest.fixture
async def test_db_pool():
    &quot;&quot;&quot;Create test database pool.&quot;&quot;&quot;
    pool = DatabasePool(database_url=&quot;postgresql://test:test@localhost/test_db&quot;)
    await pool.initialize()
    yield pool
    await pool.close()

@pytest.mark.asyncio
async def test_search_knowledge_base_with_real_db(test_db_pool):
    &quot;&quot;&quot;Test search with real database connection.&quot;&quot;&quot;
    # Setup test data
    await insert_test_documents(test_db_pool)

    # Execute search
    results = await search_knowledge_base_structured(&quot;test query&quot;, limit=5)

    # Verify results
    assert len(results) &gt; 0
    assert all(&quot;content&quot; in r for r in results)
</code></pre>
<p><strong>Test HTTP Endpoints:</strong></p>
<pre><code class="language-python">from fastapi.testclient import TestClient

@pytest.fixture
def test_client():
    &quot;&quot;&quot;Create test client for HTTP server.&quot;&quot;&quot;
    from docling_mcp.http_server import app
    return TestClient(app)

def test_metrics_endpoint_returns_prometheus_format(test_client):
    &quot;&quot;&quot;Test /metrics endpoint returns Prometheus format.&quot;&quot;&quot;
    response = test_client.get(&quot;/metrics&quot;)

    assert response.status_code == 200
    assert &quot;openmetrics-text&quot; in response.headers.get(&quot;content-type&quot;, &quot;&quot;)
    assert &quot;# HELP&quot; in response.text or &quot;# TYPE&quot; in response.text
</code></pre>
<p><strong>Test MCP Server Integration:</strong></p>
<pre><code class="language-python">@pytest.mark.asyncio
async def test_mcp_tool_integration():
    &quot;&quot;&quot;Test MCP tool with real service integration.&quot;&quot;&quot;
    # Initialize test resources
    await initialize_test_resources()

    try:
        # Execute MCP tool
        result = await query_knowledge_base(&quot;test query&quot;, limit=5)

        # Verify result format
        assert isinstance(result, str)
        assert len(result) &gt; 0

        # Verify observability (LangFuse traces, Prometheus metrics)
        assert_trace_created(&quot;query_knowledge_base&quot;)
        assert_metrics_recorded(&quot;mcp_requests_total&quot;)
    finally:
        await cleanup_test_resources()
</code></pre>
<h3 id="42-test-fixtures">4.2 Test Fixtures</h3>
<p><strong>Shared Fixtures (<code>conftest.py</code>):</strong></p>
<pre><code class="language-python">import pytest
from unittest.mock import AsyncMock, MagicMock

@pytest.fixture
def mock_httpx_response():
    &quot;&quot;&quot;Create mock httpx response.&quot;&quot;&quot;
    def _create_response(status_code=200, json_data=None, text=&quot;&quot;):
        response = MagicMock()
        response.status_code = status_code
        response.text = text
        response.json = MagicMock(return_value=json_data or {})
        return response
    return _create_response

@pytest.fixture
def mock_search_response():
    &quot;&quot;&quot;Mock successful search response.&quot;&quot;&quot;
    return {
        &quot;results&quot;: [
            {
                &quot;title&quot;: &quot;Test Document&quot;,
                &quot;content&quot;: &quot;This is test content&quot;,
                &quot;source&quot;: &quot;test-source&quot;,
                &quot;similarity&quot;: 0.95
            }
        ],
        &quot;count&quot;: 1
    }
</code></pre>
<hr />
<h2 id="5-end-to-end-testing">5. End-to-End Testing</h2>
<h3 id="51-playwright-e2e-tests">5.1 Playwright E2E Tests</h3>
<p><strong>Setup:</strong></p>
<pre><code class="language-bash"># Install Playwright
pip install playwright pytest-playwright

# Install browsers
playwright install
</code></pre>
<p><strong>Test Structure:</strong></p>
<pre><code class="language-python">import pytest
from playwright.sync_api import Page, expect

@pytest.fixture(scope=&quot;session&quot;)
def streamlit_app_url():
    &quot;&quot;&quot;Get Streamlit app URL for testing.&quot;&quot;&quot;
    return &quot;http://localhost:8501&quot;

def test_streamlit_query_workflow(page: Page, streamlit_app_url):
    &quot;&quot;&quot;Test complete Streamlit query workflow.&quot;&quot;&quot;
    # Navigate to app
    page.goto(streamlit_app_url)

    # Wait for app to load
    page.wait_for_selector('[data-testid=&quot;query-input&quot;]')

    # Enter query
    query_input = page.locator('[data-testid=&quot;query-input&quot;]')
    query_input.fill(&quot;What is the main topic?&quot;)

    # Submit query
    submit_button = page.locator('[data-testid=&quot;submit-button&quot;]')
    submit_button.click()

    # Wait for response
    page.wait_for_selector('[data-testid=&quot;response&quot;]', timeout=10000)

    # Verify response
    response = page.locator('[data-testid=&quot;response&quot;]')
    expect(response).to_contain_text(&quot;main topic&quot;)

    # Verify observability (check sidebar stats)
    sidebar_stats = page.locator('[data-testid=&quot;sidebar-stats&quot;]')
    expect(sidebar_stats).to_be_visible()
</code></pre>
<p><strong>Screenshots e Video:</strong></p>
<pre><code class="language-python">def test_streamlit_workflow_with_recording(page: Page):
    &quot;&quot;&quot;Test with screenshot and video recording.&quot;&quot;&quot;
    # Enable video recording
    page.video.path()  # Video saved automatically

    # Take screenshot on failure
    try:
        # Test logic
        pass
    except Exception:
        page.screenshot(path=&quot;test_failure.png&quot;)
        raise
</code></pre>
<h3 id="52-e2e-test-data">5.2 E2E Test Data</h3>
<p><strong>Golden Dataset:</strong>
- 20+ query-answer pairs per RAGAS evaluation
- Stored in <code>tests/fixtures/golden_dataset.json</code></p>
<p><strong>Esempio:</strong></p>
<pre><code class="language-json">{
  &quot;queries&quot;: [
    {
      &quot;question&quot;: &quot;What is the main topic of the document?&quot;,
      &quot;ground_truth&quot;: &quot;The document discusses RAG architecture patterns.&quot;,
      &quot;expected_sources&quot;: [&quot;doc1&quot;, &quot;doc2&quot;]
    },
    {
      &quot;question&quot;: &quot;How does embedding generation work?&quot;,
      &quot;ground_truth&quot;: &quot;Embedding generation uses OpenAI API to convert text to vectors.&quot;,
      &quot;expected_sources&quot;: [&quot;doc3&quot;]
    }
  ]
}
</code></pre>
<hr />
<h2 id="6-ragas-evaluation">6. RAGAS Evaluation</h2>
<h3 id="61-ragas-metrics">6.1 RAGAS Metrics</h3>
<p><strong>Metriche Standard:</strong>
- <strong>Faithfulness</strong> (0-1): Consistenza fattuale della risposta rispetto al contesto
- <strong>Answer Relevancy</strong> (0-1): Rilevanza della risposta alla domanda
- <strong>Context Precision</strong> (0-1): Precisione del retrieval (chunk rilevanti in top)
- <strong>Context Recall</strong> (0-1): Completezza del retrieval (tutti chunk rilevanti recuperati)</p>
<p><strong>Thresholds:</strong>
- Faithfulness &gt; 0.85
- Answer Relevancy &gt; 0.80
- Context Precision &gt; 0.75
- Context Recall &gt; 0.70</p>
<h3 id="62-ragas-implementation">6.2 RAGAS Implementation</h3>
<p><strong>Setup:</strong></p>
<pre><code class="language-bash">pip install ragas datasets
</code></pre>
<p><strong>Evaluation Script:</strong></p>
<pre><code class="language-python">from ragas import evaluate
from ragas.metrics import (
    Faithfulness,
    AnswerRelevancy,
    ContextPrecision,
    ContextRecall
)
from datasets import Dataset

async def run_ragas_evaluation():
    &quot;&quot;&quot;Run RAGAS evaluation on golden dataset.&quot;&quot;&quot;
    # Load golden dataset
    golden_dataset = load_golden_dataset(&quot;tests/fixtures/golden_dataset.json&quot;)

    # Generate answers using RAG pipeline
    evaluation_data = []
    for item in golden_dataset:
        answer, contexts = await generate_rag_response(item[&quot;question&quot;])
        evaluation_data.append({
            &quot;question&quot;: item[&quot;question&quot;],
            &quot;answer&quot;: answer,
            &quot;contexts&quot;: contexts,
            &quot;ground_truths&quot;: [item[&quot;ground_truth&quot;]]
        })

    # Create dataset
    eval_dataset = Dataset.from_list(evaluation_data)

    # Run evaluation
    metrics = [
        Faithfulness(),
        AnswerRelevancy(),
        ContextPrecision(),
        ContextRecall()
    ]

    results = evaluate(
        dataset=eval_dataset,
        metrics=metrics,
        llm=evaluator_llm  # Separate LLM for evaluation
    )

    # Verify thresholds
    assert results[&quot;faithfulness&quot;] &gt; 0.85
    assert results[&quot;answer_relevancy&quot;] &gt; 0.80
    assert results[&quot;context_precision&quot;] &gt; 0.75
    assert results[&quot;context_recall&quot;] &gt; 0.70

    return results
</code></pre>
<h3 id="63-langfuse-integration">6.3 LangFuse Integration</h3>
<p><strong>Track RAGAS Metrics:</strong></p>
<pre><code class="language-python">from langfuse import Langfuse

langfuse = Langfuse()

async def track_ragas_evaluation(results: dict):
    &quot;&quot;&quot;Track RAGAS evaluation results in LangFuse.&quot;&quot;&quot;
    trace = langfuse.trace(
        name=&quot;ragas_evaluation&quot;,
        metadata={
            &quot;faithfulness&quot;: results[&quot;faithfulness&quot;],
            &quot;answer_relevancy&quot;: results[&quot;answer_relevancy&quot;],
            &quot;context_precision&quot;: results[&quot;context_precision&quot;],
            &quot;context_recall&quot;: results[&quot;context_recall&quot;]
        }
    )

    # Track individual query scores
    for i, query_result in enumerate(results[&quot;individual_scores&quot;]):
        trace.span(
            name=f&quot;query_{i}&quot;,
            metadata=query_result
        )

    trace.end()
</code></pre>
<hr />
<h2 id="7-test-configuration">7. Test Configuration</h2>
<h3 id="71-pytest-configuration">7.1 pytest Configuration</h3>
<p><strong><code>pyproject.toml</code>:</strong></p>
<pre><code class="language-toml">[tool.pytest.ini_options]
asyncio_mode = &quot;auto&quot;
testpaths = [&quot;tests&quot;]
python_files = [&quot;test_*.py&quot;, &quot;*_test.py&quot;]
python_classes = [&quot;Test*&quot;]
python_functions = [&quot;test_*&quot;]
markers = [
    &quot;unit: Unit tests&quot;,
    &quot;integration: Integration tests&quot;,
    &quot;e2e: End-to-end tests&quot;,
    &quot;slow: Slow running tests&quot;,
    &quot;ragas: RAGAS evaluation tests&quot;
]
</code></pre>
<h3 id="72-coverage-configuration">7.2 Coverage Configuration</h3>
<p><strong>Coverage Thresholds:</strong></p>
<pre><code class="language-toml">[tool.coverage.run]
source = [&quot;core&quot;, &quot;docling_mcp&quot;, &quot;ingestion&quot;, &quot;utils&quot;]
omit = [&quot;*/tests/*&quot;, &quot;*/test_*.py&quot;]

[tool.coverage.report]
precision = 2
show_missing = true
skip_covered = false
fail_under = 70

[tool.coverage.html]
directory = &quot;htmlcov&quot;
</code></pre>
<h3 id="73-test-markers">7.3 Test Markers</h3>
<p><strong>Uso dei Markers:</strong></p>
<pre><code class="language-python">import pytest

@pytest.mark.unit
def test_unit_functionality():
    &quot;&quot;&quot;Unit test.&quot;&quot;&quot;
    pass

@pytest.mark.integration
def test_integration_functionality():
    &quot;&quot;&quot;Integration test.&quot;&quot;&quot;
    pass

@pytest.mark.e2e
@pytest.mark.slow
def test_e2e_workflow():
    &quot;&quot;&quot;E2E test (slow).&quot;&quot;&quot;
    pass

@pytest.mark.ragas
def test_ragas_evaluation():
    &quot;&quot;&quot;RAGAS evaluation test.&quot;&quot;&quot;
    pass
</code></pre>
<p><strong>Eseguire test per categoria:</strong></p>
<pre><code class="language-bash"># Solo unit tests
pytest -m unit

# Solo integration tests
pytest -m integration

# Escludere test lenti
pytest -m &quot;not slow&quot;

# Solo RAGAS evaluation
pytest -m ragas
</code></pre>
<hr />
<h2 id="8-cicd-integration">8. CI/CD Integration</h2>
<h3 id="81-github-actions-workflow">8.1 GitHub Actions Workflow</h3>
<p><strong>Test Pipeline:</strong></p>
<pre><code class="language-yaml">name: Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install uv
          uv pip install -e &quot;.[dev]&quot;

      - name: Run unit tests
        run: |
          pytest tests/unit/ -v --cov=core --cov=docling_mcp --cov-report=xml

      - name: Run integration tests
        run: |
          pytest tests/integration/ -v

      - name: Check coverage
        run: |
          pytest --cov=core --cov=docling_mcp --cov-fail-under=70

      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage.xml
</code></pre>
<h3 id="82-pre-commit-hooks">8.2 Pre-commit Hooks</h3>
<p><strong>Test Before Commit:</strong></p>
<pre><code class="language-yaml"># .pre-commit-config.yaml
repos:
  - repo: local
    hooks:
      - id: pytest-unit
        name: Run unit tests
        entry: pytest tests/unit/ -v
        language: system
        pass_filenames: false
        always_run: true
</code></pre>
<hr />
<h2 id="9-test-best-practices">9. Test Best Practices</h2>
<h3 id="91-test-isolation">9.1 Test Isolation</h3>
<p><strong>Principi:</strong>
- Ogni test deve essere indipendente
- Non dipendere da ordine di esecuzione
- Cleanup dopo ogni test</p>
<p><strong>Esempio:</strong></p>
<pre><code class="language-python">@pytest.fixture(autouse=True)
def cleanup_test_state():
    &quot;&quot;&quot;Cleanup test state before and after each test.&quot;&quot;&quot;
    # Setup
    yield
    # Cleanup
    reset_global_state()
    clear_test_cache()
</code></pre>
<h3 id="92-test-data-management">9.2 Test Data Management</h3>
<p><strong>Pattern:</strong>
- Usare fixtures per test data riutilizzabili
- Golden dataset per RAGAS evaluation
- Test database separato per integration tests</p>
<p><strong>Esempio:</strong></p>
<pre><code class="language-python">@pytest.fixture
def sample_documents():
    &quot;&quot;&quot;Sample documents for testing.&quot;&quot;&quot;
    return [
        {
            &quot;id&quot;: &quot;doc1&quot;,
            &quot;title&quot;: &quot;Test Document 1&quot;,
            &quot;content&quot;: &quot;This is test content for document 1.&quot;,
            &quot;source&quot;: &quot;test-source&quot;
        },
        {
            &quot;id&quot;: &quot;doc2&quot;,
            &quot;title&quot;: &quot;Test Document 2&quot;,
            &quot;content&quot;: &quot;This is test content for document 2.&quot;,
            &quot;source&quot;: &quot;test-source&quot;
        }
    ]
</code></pre>
<h3 id="93-error-testing">9.3 Error Testing</h3>
<p><strong>Test Error Cases:</strong></p>
<pre><code class="language-python">def test_search_with_invalid_query_raises_error():
    &quot;&quot;&quot;Test search raises error for invalid query.&quot;&quot;&quot;
    with pytest.raises(ValueError, match=&quot;Query cannot be empty&quot;):
        search_knowledge_base(&quot;&quot;)

def test_database_connection_error_handled_gracefully():
    &quot;&quot;&quot;Test graceful handling of database errors.&quot;&quot;&quot;
    with patch('utils.db_utils.db_pool.acquire', side_effect=ConnectionError):
        # Should not crash, should return error message
        result = await query_knowledge_base(&quot;test&quot;)
        assert &quot;error&quot; in result.lower()
</code></pre>
<h3 id="94-performance-testing">9.4 Performance Testing</h3>
<p><strong>Test Performance Critical Paths:</strong></p>
<pre><code class="language-python">import time

def test_embedding_generation_performance():
    &quot;&quot;&quot;Test embedding generation meets performance SLO.&quot;&quot;&quot;
    start_time = time.time()
    embedding = await generate_embedding(&quot;test query&quot;)
    duration = time.time() - start_time

    # SLO: &lt;500ms for embedding generation
    assert duration &lt; 0.5, f&quot;Embedding took {duration}s, exceeds 500ms SLO&quot;
    assert len(embedding) &gt; 0
</code></pre>
<hr />
<h2 id="10-test-maintenance">10. Test Maintenance</h2>
<h3 id="101-test-documentation">10.1 Test Documentation</h3>
<p><strong>Documentare Test:</strong>
- Docstring descrittivi per ogni test
- Spiegare cosa testa e perché
- Documentare setup requirements</p>
<p><strong>Esempio:</strong></p>
<pre><code class="language-python">def test_langfuse_graceful_degradation():
    &quot;&quot;&quot;
    Test LangFuse graceful degradation when unavailable.

    This test verifies that the system continues to function
    normally when LangFuse SDK is not installed or unavailable.
    This is critical for production reliability.
    &quot;&quot;&quot;
    pass
</code></pre>
<h3 id="102-test-refactoring">10.2 Test Refactoring</h3>
<p><strong>Quando Refactorare:</strong>
- Test duplicati → Estrai fixture comune
- Test troppo lunghi → Suddividi in test più piccoli
- Test instabili → Isola dipendenze esterne</p>
<p><strong>Esempio:</strong></p>
<pre><code class="language-python"># ❌ Errato - Test troppo lungo
def test_complete_workflow():
    # Setup (20 lines)
    # Test step 1 (10 lines)
    # Test step 2 (10 lines)
    # Test step 3 (10 lines)
    # Assertions (10 lines)
    pass

# ✅ Corretto - Test focalizzati
def test_workflow_step1():
    &quot;&quot;&quot;Test workflow step 1.&quot;&quot;&quot;
    pass

def test_workflow_step2():
    &quot;&quot;&quot;Test workflow step 2.&quot;&quot;&quot;
    pass

def test_workflow_integration():
    &quot;&quot;&quot;Test complete workflow integration.&quot;&quot;&quot;
    pass
</code></pre>
<hr />
<h2 id="11-testing-checklist">11. Testing Checklist</h2>
<p>Prima di considerare una feature completa:</p>
<ul>
<li>[ ] Unit tests scritti per tutte le funzioni pubbliche</li>
<li>[ ] Integration tests per interazioni critiche</li>
<li>[ ] E2E tests per workflow principali (se applicabile)</li>
<li>[ ] Coverage &gt;70% per moduli core</li>
<li>[ ] Test error cases (invalid input, failures)</li>
<li>[ ] Test performance critical paths (se applicabile)</li>
<li>[ ] RAGAS evaluation per funzionalità RAG (se applicabile)</li>
<li>[ ] Test documentati con docstring descrittivi</li>
<li>[ ] Test isolati e indipendenti</li>
<li>[ ] CI/CD pipeline passa tutti i test</li>
</ul>
<hr />
<h2 id="12-references">12. References</h2>
<h3 id="internal-documentation">Internal Documentation</h3>
<ul>
<li><strong><a href="../coding-standards/">Coding Standards</a></strong>: Code style guide and testing standards section</li>
<li><strong><a href="./unified-project-structure.md">Unified Project Structure</a></strong>: Test organization standards and directory structure</li>
<li><strong><a href="../architecture/">Architecture</a></strong>: System architecture and testing infrastructure decisions</li>
<li><strong><a href="../epics/#Epic-5-Testing-&amp;-Quality-Assurance">Epic 5 Requirements</a></strong>: Complete Epic 5 requirements with acceptance criteria</li>
<li><strong><a href="../development-guide/">Development Guide</a></strong>: Setup instructions and test execution workflow</li>
</ul>
<h3 id="external-references">External References</h3>
<ul>
<li><strong>pytest Documentation</strong>: https://docs.pytest.org/</li>
<li><strong>pytest-asyncio</strong>: https://pytest-asyncio.readthedocs.io/</li>
<li><strong>RAGAS Documentation</strong>: https://docs.ragas.io/</li>
<li><strong>Playwright Documentation</strong>: https://playwright.dev/python/</li>
<li><strong>PydanticAI Testing</strong>: https://ai.pydantic.dev/testing/</li>
<li><strong>Coverage.py</strong>: https://coverage.readthedocs.io/</li>
</ul>
<hr />
<h2 id="changelog">Changelog</h2>
<ul>
<li><strong>2025-01-27</strong>: Initial version based on existing test structure and Epic 5 requirements</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "toc.integrate", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>