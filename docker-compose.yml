# Docker Compose Configuration - Supabase Database
# ================================================
#
# Questo docker-compose.yml è configurato per usare Supabase (cloud database).
#
# REQUISITI:
# - File .env con DATABASE_URL Supabase configurato
# - Schema database già inizializzato su Supabase
#
# USAGE:
#   docker compose up -d
#
# ================================================

services:
  rag-api:
    build:
      context: .
      dockerfile: Dockerfile.api
    container_name: docling-rag-api
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - OPENAI_BASE_URL=${OPENAI_BASE_URL}
      - EMBEDDING_MODEL=${EMBEDDING_MODEL:-text-embedding-3-small}
      - LLM_CHOICE=${LLM_CHOICE:-gpt-4.1-mini}
    networks:
      - rag-network
    volumes:
      - ./documents:/app/documents

  mcp-server:
    build:
      context: .
      dockerfile: Dockerfile.mcp
    container_name: docling-rag-mcp
    ports:
      - "8080:8080"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - OPENAI_BASE_URL=${OPENAI_BASE_URL}
      - EMBEDDING_MODEL=${EMBEDDING_MODEL:-text-embedding-3-small}
      - METRICS_PORT=8080
    depends_on:
      rag-api:
        condition: service_started
    networks:
      - rag-network

  streamlit:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: docling-rag-streamlit
    ports:
      - "8501:8501"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - OPENAI_BASE_URL=${OPENAI_BASE_URL}
    networks:
      - rag-network

networks:
  rag-network:
    driver: bridge
